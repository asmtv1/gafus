# ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã Re-engagement

## üéØ –¶–µ–ª—å

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –í–°–ï–ú –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫).

---

## üìù –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –∑–∞ 5 –º–∏–Ω—É—Ç

### 1Ô∏è‚É£ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (SQL)

```sql
-- –ù–∞–π–¥–∏—Ç–µ –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT id, username FROM "User" WHERE role = 'USER' LIMIT 1;

-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ ID, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–º–µ—Å—Ç–æ USER_ID_HERE –Ω–∏–∂–µ

-- –°–¥–µ–ª–∞–π—Ç–µ –µ–≥–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º (6 –¥–Ω–µ–π –Ω–∞–∑–∞–¥)
UPDATE "UserStep"
SET "updatedAt" = NOW() - INTERVAL '6 days'
WHERE "userTrainingId" IN (
  SELECT id FROM "UserTraining" WHERE "userId" = 'USER_ID_HERE'
)
AND status = 'COMPLETED';
```

### 2Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: http://localhost:3001/main-panel/reengagement
2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ ADMIN
3. –ù–∞–∂–º–∏—Ç–µ **"–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫"**

### 3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**

```
‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!
üÜï –ù–æ–≤—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π: 1
üì® –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ: 1
‚úîÔ∏è –ö–∞–º–ø–∞–Ω–∏–π –∑–∞–∫—Ä—ã—Ç–æ: 0
```

### 4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
SELECT * FROM "ReengagementCampaign"
WHERE "userId" = 'USER_ID_HERE'
ORDER BY "createdAt" DESC LIMIT 1;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
SELECT * FROM "ReengagementNotification"
WHERE "campaignId" = (
  SELECT id FROM "ReengagementCampaign"
  WHERE "userId" = 'USER_ID_HERE'
  ORDER BY "createdAt" DESC LIMIT 1
);
```

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**

- –ö–∞–º–ø–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞ (`isActive` = true, `currentLevel` = 1)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ (`sent` = false, `level` = 1)

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –µ—Å–ª–∏:

- ‚úÖ –ö–∞–º–ø–∞–Ω–∏—è —Å–æ–∑–¥–∞–ª–∞—Å—å –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ù–ï –ø—Ä–æ–≤–µ—Ä—è–ª–∞—Å—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `reengagementSettings.enabled`
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –ë–î
- ‚úÖ –ó–∞–¥–∞—á–∞ –µ—Å—Ç—å –≤ –æ—á–µ—Ä–µ–¥–∏ BullMQ (http://localhost:3007)

---

## üîß –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "–ù–æ–≤—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π: 0"

**–ü—Ä–∏—á–∏–Ω–∞:** –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è < 2 –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–π
SELECT COUNT(*) FROM "UserStep" us
JOIN "UserTraining" ut ON us."userTrainingId" = ut.id
WHERE ut."userId" = 'USER_ID_HERE' AND us.status = 'COMPLETED';

-- –ï—Å–ª–∏ –º–µ–Ω—å—à–µ 2, —Å–æ–∑–¥–∞—Ç—å –µ—â–µ –æ–¥–∏–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —à–∞–≥
-- (—Å–º. –ø–æ–ª–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤ REENGAGEMENT_TESTING.md)
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞"

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**

1. Worker –∑–∞–ø—É—â–µ–Ω? (`pnpm run start` –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞)
2. –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞? (`psql` –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?)
3. –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (F12 ‚Üí Console)

---

## üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–º. `docs/testing/REENGAGEMENT_TESTING.md`
