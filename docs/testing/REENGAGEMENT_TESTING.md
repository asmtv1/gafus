# üß™ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã Re-engagement

## –û–±–∑–æ—Ä

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã re-engagement (–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –í–°–ï–ú –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º), –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã.

---

## üìã –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º

‚úÖ **–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ 5+ –¥–Ω–µ–π  
‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–π** - —Å–æ–∑–¥–∞—é—Ç—Å—è –ª–∏ –∫–∞–º–ø–∞–Ω–∏–∏ –¥–ª—è –≤—Å–µ—Ö –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫)  
‚úÖ **–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** - —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π  
‚úÖ **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –∏–º—è –ø–∏—Ç–æ–º—Ü–∞ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è  
‚úÖ **–ó–∞–∫—Ä—ã—Ç–∏–µ –∫–∞–º–ø–∞–Ω–∏–π** - –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ª–∏ –∫–∞–º–ø–∞–Ω–∏–∏ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
‚úÖ **–ú–µ—Ç—Ä–∏–∫–∏** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–∏ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

---

## üéØ –°–ø–æ—Å–æ–± 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é:

```sql
-- –í PostgreSQL (psql –∏–ª–∏ pgAdmin)

-- 1. –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ç–µ—Å—Ç–∞
SELECT id, username, email FROM "User" WHERE role = 'USER' LIMIT 5;

-- 2. –°–æ–∑–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —à–∞–≥–∏ —É —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
-- (–º–∏–Ω–∏–º—É–º 2 —à–∞–≥–∞, —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ —Ñ–∏–ª—å—Ç—Ä MIN_COMPLETED_STEPS)

-- 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞ 6 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
UPDATE "UserStep" 
SET "updatedAt" = NOW() - INTERVAL '6 days'
WHERE "userTrainingId" IN (
  SELECT id FROM "UserTraining" WHERE "userId" = 'USER_ID_HERE'
)
AND status = 'COMPLETED';
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: `http://localhost:3001/main-panel/reengagement`
2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ ADMIN
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫"**
4. –î–æ–∂–¥–∏—Ç–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (5-10 —Å–µ–∫—É–Ω–¥)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!
üÜï –ù–æ–≤—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π: 1
üì® –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ: 1
‚úîÔ∏è –ö–∞–º–ø–∞–Ω–∏–π –∑–∞–∫—Ä—ã—Ç–æ: 0
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- **–í—Å–µ–≥–æ –∫–∞–º–ø–∞–Ω–∏–π** - –¥–æ–ª–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è –Ω–∞ 1
- **–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π** - –¥–æ–ª–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è –Ω–∞ 1
- **–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏** - –Ω–æ–≤–∞—è –∫–∞–º–ø–∞–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—É—é –∫–∞–º–ø–∞–Ω–∏—é
SELECT * FROM "ReengagementCampaign" 
WHERE "userId" = 'USER_ID_HERE' 
ORDER BY "createdAt" DESC 
LIMIT 1;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
SELECT * FROM "ReengagementNotification" 
WHERE "campaignId" IN (
  SELECT id FROM "ReengagementCampaign" 
  WHERE "userId" = 'USER_ID_HERE'
)
ORDER BY "createdAt" DESC;
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `isActive` = `true`
- `currentLevel` = `1`
- `nextNotificationDate` = –¥–∞—Ç–∞ —á–µ—Ä–µ–∑ 5 –¥–Ω–µ–π –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- `totalNotificationsSent` = `0` (–∑–∞–¥–∞—á–∞ –≤ –æ—á–µ—Ä–µ–¥–∏, –Ω–æ –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞)

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–∏ BullMQ

1. –û—Ç–∫—Ä–æ–π—Ç–µ Bull Board: `http://localhost:3007`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –æ—á–µ—Ä–µ–¥—å `reengagement`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∑–∞–¥–∞—á–∏ `send-reengagement-notification`

**–û–∂–∏–¥–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
```json
{
  "campaignId": "...",
  "userId": "...",
  "level": 1
}
```

---

## üî¨ –°–ø–æ—Å–æ–± 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã Node.js

### –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

**–§–∞–π–ª:** `scripts/test-reengagement.js`

```javascript
const { PrismaClient } = require('@prisma/client');
const { findInactiveUsers } = require('@gafus/reengagement');

const prisma = new PrismaClient();

async function testReengagement() {
  try {
    console.log('üîç –ü–æ–∏—Å–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...\n');
    
    const inactiveUsers = await findInactiveUsers();
    
    console.log(`üìä –ù–∞–π–¥–µ–Ω–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${inactiveUsers.length}\n`);
    
    inactiveUsers.forEach((user, index) => {
      console.log(`${index + 1}. User ID: ${user.userId}`);
      console.log(`   –î–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: ${user.daysSinceActivity}`);
      console.log(`   –í—Å–µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–π: ${user.totalCompletions}`);
      console.log(`   –ê–∫—Ç–∏–≤–Ω–∞—è –∫–∞–º–ø–∞–Ω–∏—è: ${user.hasActiveCampaign ? '–î–∞' : '–ù–µ—Ç'}`);
      console.log('');
    });
    
    console.log('‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω');
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
  } finally {
    await prisma.$disconnect();
  }
}

testReengagement();
```

### –ó–∞–ø—É—Å–∫:

```bash
cd /Users/asmtv1/Desktop/gafus\ \(zod\)
node scripts/test-reengagement.js
```

---

## üß™ –°–ø–æ—Å–æ–± 3: –ü–æ–ª–Ω–æ–µ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—à–µ–ª –∏ –≤–µ—Ä–Ω—É–ª—Å—è

**1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
```sql
-- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ 6 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
UPDATE "UserStep" 
SET "updatedAt" = NOW() - INTERVAL '6 days'
WHERE "userTrainingId" IN (
  SELECT id FROM "UserTraining" WHERE "userId" = 'TEST_USER_ID'
);
```

**2. –ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞** (—á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)
- –î–æ–ª–∂–Ω–∞ —Å–æ–∑–¥–∞—Ç—å—Å—è –∫–∞–º–ø–∞–Ω–∏—è —É—Ä–æ–≤–Ω—è 1
- –ó–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –¥–æ–±–∞–≤–∏—Ç—å—Å—è –≤ –æ—á–µ—Ä–µ–¥—å

**3. –ò–º–∏—Ç–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
```sql
-- –ó–∞–≤–µ—Ä—à–∏—Ç—å –Ω–æ–≤—ã–π —à–∞–≥
INSERT INTO "UserStep" ("id", "userTrainingId", "dayNumber", "stepIndex", "status", "createdAt", "updatedAt")
VALUES (
  gen_random_uuid(),
  'USER_TRAINING_ID',
  1,
  1,
  'COMPLETED',
  NOW(),
  NOW()
);
```

**4. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞**
- –ö–∞–º–ø–∞–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –∑–∞–∫—Ä—ã—Ç—å—Å—è (`isActive` = `false`, `returned` = `true`)

---

## üìä –°–ø–æ—Å–æ–± 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–º–µ–Ω–∏ –ø–∏—Ç–æ–º—Ü–∞

```sql
-- –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–∏—Ç–æ–º—Ü–µ–º
SELECT u.id, u.username, p.dogName 
FROM "User" u
LEFT JOIN "Profile" p ON u.id = p."userId"
WHERE p."dogName" IS NOT NULL
LIMIT 5;

-- –°–¥–µ–ª–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º
UPDATE "UserStep" 
SET "updatedAt" = NOW() - INTERVAL '6 days'
WHERE "userTrainingId" IN (
  SELECT id FROM "UserTraining" WHERE "userId" = 'USER_WITH_DOG_ID'
);
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏:
```sql
SELECT title, body FROM "ReengagementNotification"
WHERE "campaignId" IN (
  SELECT id FROM "ReengagementCampaign" 
  WHERE "userId" = 'USER_WITH_DOG_ID'
);
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ò–º—è –ø–∏—Ç–æ–º—Ü–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ —Ç–µ–∫—Å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

---

## üîç –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é 5+ –¥–Ω–µ–π
- [ ] –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `reengagementSettings.enabled` (–æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ–º)
- [ ] –°–æ–∑–¥–∞—é—Ç—Å—è –∫–∞–º–ø–∞–Ω–∏–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –º–∏–Ω–∏–º—É–º 2 –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º–∏ —à–∞–≥–∞–º–∏
- [ ] –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–µ–π –Ω–æ–≤–∞—è –ù–ï —Å–æ–∑–¥–∞–µ—Ç—Å—è
- [ ] –ó–∞–¥–∞—á–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å BullMQ
- [ ] –ö–∞–º–ø–∞–Ω–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω–µ–π

- [ ] –£—Ä–æ–≤–µ–Ω—å 1: —á–µ—Ä–µ–∑ 5 –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- [ ] –£—Ä–æ–≤–µ–Ω—å 2: —á–µ—Ä–µ–∑ 12 –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- [ ] –£—Ä–æ–≤–µ–Ω—å 3: —á–µ—Ä–µ–∑ 20 –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- [ ] –£—Ä–æ–≤–µ–Ω—å 4: —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–º—è –ø–∏—Ç–æ–º—Ü–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∫—É—Ä—Å–∞—Ö
- [ ] –ù–µ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫

- [ ] Click rate —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Return rate —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ —É—Ä–æ–≤–Ω—è–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ —Ç–∏–ø–∞–º —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

---

## üêõ –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é 5+ –¥–Ω–µ–π
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–∂–µ –∏–º–µ—é—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø—Ä–æ—à–ª–∏ —Ñ–∏–ª—å—Ç—Ä MIN_COMPLETED_STEPS (< 2 –∑–∞–≤–µ—Ä—à–µ–Ω–∏–π)

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤
SELECT ut."userId", COUNT(*) as completed_steps
FROM "UserStep" us
JOIN "UserTraining" ut ON us."userTrainingId" = ut.id
WHERE us.status = 'COMPLETED'
GROUP BY ut."userId"
HAVING COUNT(*) >= 2;
```

### –ü—Ä–æ–±–ª–µ–º–∞: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
- –û—á–µ—Ä–µ–¥—å BullMQ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞
- Worker –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç push-–ø–æ–¥–ø–∏—Å–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É worker
cd packages/worker
pnpm start

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT * FROM "PushSubscription" WHERE "userId" = 'USER_ID';
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞–º–ø–∞–Ω–∏–∏ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ

**–ü—Ä–∏—á–∏–Ω—ã:**
- –§—É–Ω–∫—Ü–∏—è `checkAndCloseReturnedCampaigns()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- –î–∞—Ç–∞ –≤ `updatedAt` –Ω–µ –ø–æ—Å–ª–µ `campaignStartDate`

**–†–µ—à–µ–Ω–∏–µ:**
–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ (–≤ –±–æ–µ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ - —á–µ—Ä–µ–∑ cron).

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

```bash
# –ó–∞–ø—É—Å–∫–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 8:00 MSK
0 8 * * * cd /path/to/project && node -e "require('@gafus/reengagement').scheduleReengagementCampaigns()"
```

### –ê–ª–µ—Ä—Ç—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –µ—Å–ª–∏:
- Click rate < 5% (–ø–ª–æ—Ö–∞—è –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å)
- Return rate < 10% (—Å–∏—Å—Ç–µ–º–∞ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞)
- –ù–µ—Ç –Ω–æ–≤—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π > 7 –¥–Ω–µ–π (–ø—Ä–æ–±–ª–µ–º—ã —Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º)

---

## ‚úÖ –£—Å–ø–µ—à–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –µ—Å–ª–∏:

1. ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–∞—Ö–æ–¥–∏—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. ‚úÖ –°–æ–∑–¥–∞—é—Ç—Å—è –∫–∞–º–ø–∞–Ω–∏–∏ –¥–ª—è –í–°–ï–• –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫)
3. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
4. ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–∏–º—è –ø–∏—Ç–æ–º—Ü–∞, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è)
5. ‚úÖ –ö–∞–º–ø–∞–Ω–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
6. ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
7. ‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üÜò –ü–æ–º–æ—â—å

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ worker: `packages/worker/logs/`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Bull Board: `http://localhost:3007`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)

**–õ–æ–≥–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤:**
- Worker: –∫–æ–Ω—Å–æ–ª—å worker –ø—Ä–æ—Ü–µ—Å—Å–∞
- Admin-panel: –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
- –ë–î: `@gafus/logger` –ø–∏—à–µ—Ç –≤ Error Dashboard

