# Telegram Bot (@gafus/telegram-bot)

## üìã –û–±–∑–æ—Ä

Telegram Bot GAFUS - —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–æ—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

- **üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö** - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –Ω–∞—á–∞–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
- **üìä –ü—Ä–æ–≥—Ä–µ—Å—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫** - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —ç—Ç–∞–ø–æ–≤
- **üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è** - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä–∞–¥
- **üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫** - –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

- **üîê –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è** - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ Telegram
- **‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞** - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- **üîó –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤** - –ü—Ä–∏–≤—è–∑–∫–∞ Telegram –∫ –ø—Ä–æ—Ñ–∏–ª—é

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- **üìö –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã
- **üìû –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –°–≤—è–∑—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
- **üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –õ–∏—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
apps/telegram-bot/
‚îú‚îÄ‚îÄ bot.ts                   # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞
‚îú‚îÄ‚îÄ src/                     # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (–µ—Å–ª–∏ –µ—Å—Ç—å)
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ tsconfig.json
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π

```typescript
// bot.ts - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞
import { Bot } from "grammy";
import { PrismaClient } from "@gafus/prisma";
import { logger } from "@gafus/logger";

const bot = new Bot(process.env.TELEGRAM_BOT_TOKEN!);
const prisma = new PrismaClient();
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥

```typescript
// –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
bot.command("start", async (ctx) => {
  const username = ctx.from?.username;
  if (username) {
    const user = await prisma.user.findUnique({
      where: { telegramId: ctx.from?.id.toString() },
    });

    if (user) {
      await ctx.reply(`–ü—Ä–∏–≤–µ—Ç, ${user.username}! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ GAFUS!`);
    } else {
      await ctx.reply("–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç —Å –ø—Ä–æ—Ñ–∏–ª–µ–º –Ω–∞ —Å–∞–π—Ç–µ.");
    }
  }
});

bot.command("help", async (ctx) => {
  const helpText = `
ü§ñ GAFUS Bot - –ü–æ–º–æ—â–Ω–∏–∫ –ø–æ –æ–±—É—á–µ–Ω–∏—é –ø–∏—Ç–æ–º—Ü–µ–≤

üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
/help - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
/reset_password - –°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å
/stats - –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
/support - –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
  `;
  await ctx.reply(helpText);
});
```

### –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è

```typescript
bot.command("reset_password", async (ctx) => {
  const username = ctx.message?.text?.split(" ")[1];

  if (!username) {
    await ctx.reply("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: /reset_password your_username");
    return;
  }

  try {
    // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = await prisma.user.findUnique({
      where: { username },
    });

    if (!user) {
      await ctx.reply("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.");
      return;
    }

    // –°–≤—è–∑—ã–≤–∞–Ω–∏–µ Telegram ID —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
    await prisma.user.update({
      where: { id: user.id },
      data: { telegramId: ctx.from?.id.toString() },
    });

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
    const resetToken = generateResetToken();
    await prisma.passwordResetToken.create({
      data: {
        token: resetToken,
        userId: user.id,
        expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 —á–∞—Å–∞
      },
    });

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Å—ã–ª–∫–∏ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
    const resetUrl = `${process.env.NEXT_PUBLIC_APP_URL}/reset-password?token=${resetToken}`;
    await ctx.reply(`–î–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ: ${resetUrl}`);

    logger.info("Password reset requested via Telegram", {
      userId: user.id,
      username: user.username,
      telegramId: ctx.from?.id,
    });
  } catch (error) {
    logger.error("Error in password reset", { error: error.message });
    await ctx.reply("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –ø–∞—Ä–æ–ª—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
  }
});
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö

```typescript
// –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ
async function sendTrainingNotification(userId: string, trainingData: any) {
  try {
    const user = await prisma.user.findUnique({
      where: { id: userId },
      include: { pets: true },
    });

    if (!user?.telegramId) return;

    const message = `
üèÉ‚Äç‚ôÇÔ∏è –í—Ä–µ–º—è –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏!

üìö –ö—É—Ä—Å: ${trainingData.courseName}
üìÖ –î–µ–Ω—å: ${trainingData.dayTitle}
‚è±Ô∏è –®–∞–≥: ${trainingData.stepTitle}
‚è∞ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${trainingData.duration} –º–∏–Ω—É—Ç

üêï –ü–∏—Ç–æ–º–µ—Ü: ${user.pets[0]?.name || "–í–∞—à –ø–∏—Ç–æ–º–µ—Ü"}

–£–¥–∞—á–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏! üéØ
    `;

    await bot.api.sendMessage(user.telegramId, message, {
      reply_markup: {
        inline_keyboard: [[{ text: "üì± –û—Ç–∫—Ä—ã—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É", url: trainingData.trainingUrl }]],
      },
    });

    logger.info("Training notification sent", {
      userId,
      telegramId: user.telegramId,
      trainingId: trainingData.trainingId,
    });
  } catch (error) {
    logger.error("Failed to send training notification", {
      userId,
      error: error.message,
    });
  }
}
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```typescript
bot.command("stats", async (ctx) => {
  try {
    const user = await prisma.user.findUnique({
      where: { telegramId: ctx.from?.id.toString() },
      include: {
        pets: true,
        userTrainings: {
          where: { status: "COMPLETED" },
          include: {
            dayOnCourse: {
              include: { course: true },
            },
          },
        },
      },
    });

    if (!user) {
      await ctx.reply("–ê–∫–∫–∞—É–Ω—Ç –Ω–µ —Å–≤—è–∑–∞–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /reset_password –¥–ª—è —Å–≤—è–∑–∏ –∞–∫–∫–∞—É–Ω—Ç–∞.");
      return;
    }

    const completedTrainings = user.userTrainings.length;
    const totalPets = user.pets.length;
    const completedCourses = new Set(user.userTrainings.map((t) => t.dayOnCourse.courseId)).size;

    const statsMessage = `
üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ GAFUS:

üêï –ü–∏—Ç–æ–º—Ü–µ–≤: ${totalPets}
üìö –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤: ${completedCourses}
üèÉ‚Äç‚ôÇÔ∏è –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: ${completedTrainings}

–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ! üéØ
    `;

    await ctx.reply(statsMessage);
  } catch (error) {
    logger.error("Error getting user stats", { error: error.message });
    await ctx.reply("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
  }
});
```

## üîî –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—á–µ—Ä–µ–¥—è–º–∏

```typescript
import { addJob } from "@gafus/queues";

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
async function scheduleNotification(userId: string, notificationData: any) {
  await addJob(
    "telegram-notifications",
    "send-notification",
    {
      userId,
      ...notificationData,
    },
    {
      delay: notificationData.delay || 0,
      attempts: 3,
    },
  );
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
export async function processNotification(job: any) {
  const { userId, type, data } = job.data;

  switch (type) {
    case "training_reminder":
      await sendTrainingNotification(userId, data);
      break;
    case "achievement":
      await sendAchievementNotification(userId, data);
      break;
    case "course_completed":
      await sendCourseCompletedNotification(userId, data);
      break;
    default:
      logger.warn("Unknown notification type", { type, userId });
  }
}
```

### –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```typescript
// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏
async function sendAchievementNotification(userId: string, achievementData: any) {
  const user = await prisma.user.findUnique({
    where: { id: userId },
  });

  if (!user?.telegramId) return;

  const message = `
üèÜ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ–º!

${achievementData.title}
${achievementData.description}

üéØ –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏!
  `;

  await bot.api.sendMessage(user.telegramId, message);
}

// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∫—É—Ä—Å–∞
async function sendCourseCompletedNotification(userId: string, courseData: any) {
  const user = await prisma.user.findUnique({
    where: { id: userId },
  });

  if (!user?.telegramId) return;

  const message = `
üéâ –ö—É—Ä—Å –∑–∞–≤–µ—Ä—à–µ–Ω!

üìö "${courseData.courseName}"
‚è±Ô∏è –í—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è: ${courseData.completionTime}
üèÜ –ü–æ–ª—É—á–µ–Ω–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π: ${courseData.achievements}

–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! üéØ
  `;

  await bot.api.sendMessage(user.telegramId, message);
}
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥

```typescript
// Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
bot.use(async (ctx, next) => {
  const telegramId = ctx.from?.id.toString();

  if (ctx.message?.text?.startsWith("/reset_password")) {
    // –ö–æ–º–∞–Ω–¥–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º
    return next();
  }

  // –î–ª—è –¥—Ä—É–≥–∏—Ö –∫–æ–º–∞–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤—è–∑—å —Å –∞–∫–∫–∞—É–Ω—Ç–æ–º
  const user = await prisma.user.findUnique({
    where: { telegramId },
  });

  if (!user) {
    await ctx.reply(
      "–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç —Å –ø—Ä–æ—Ñ–∏–ª–µ–º –Ω–∞ —Å–∞–π—Ç–µ.",
    );
    return;
  }

  return next();
});
```

### Rate limiting

```typescript
import { rateLimit } from "./utils/rateLimit";

// –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
bot.use(
  rateLimit({
    windowMs: 60000, // 1 –º–∏–Ω—É—Ç–∞
    max: 10, // –º–∞–∫—Å–∏–º—É–º 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
  }),
);
```

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π

```typescript
import { logger } from "@gafus/logger";

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
bot.use(async (ctx, next) => {
  const command = ctx.message?.text?.split(" ")[0];
  const userId = ctx.from?.id;

  logger.info("Telegram command received", {
    command,
    userId,
    username: ctx.from?.username,
    chatId: ctx.chat?.id,
  });

  return next();
});
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```typescript
// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
bot.catch((err) => {
  logger.error("Telegram bot error", {
    error: err.message,
    stack: err.stack,
    update: err.ctx?.update,
  });
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
bot.api.config.use((previous, method, payload, signal) => {
  return previous(method, payload, signal).catch((error) => {
    logger.error("Telegram API error", {
      method,
      error: error.message,
      payload,
    });
    throw error;
  });
});
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã

```typescript
import { describe, it, expect, jest } from "@jest/globals";

describe("Telegram Bot", () => {
  it("should handle start command", async () => {
    const mockCtx = {
      from: { id: 123, username: "testuser" },
      reply: jest.fn(),
    };

    await handleStartCommand(mockCtx);

    expect(mockCtx.reply).toHaveBeenCalled();
  });
});
```

### Integration —Ç–µ—Å—Ç—ã

```typescript
import { Bot } from "grammy";

describe("Bot Integration", () => {
  it("should send notification", async () => {
    const bot = new Bot("test-token");

    await sendTrainingNotification("user123", {
      courseName: "Test Course",
      dayTitle: "Day 1",
      stepTitle: "Step 1",
    });

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
  });
});
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# Telegram Bot
TELEGRAM_BOT_TOKEN=your-bot-token
TELEGRAM_WEBHOOK_URL=https://your-domain.com/api/telegram-webhook

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/gafus

# App URLs
NEXT_PUBLIC_APP_URL=https://gafus.ru
```

### Docker

```dockerfile
FROM node:18-alpine

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

EXPOSE 3000
CMD ["node", "dist/bot.js"]
```

### Webhook –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```typescript
// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
if (process.env.NODE_ENV === "production") {
  await bot.api.setWebhook(process.env.TELEGRAM_WEBHOOK_URL!);
}
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
pnpm dev                    # –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pnpm build                  # –°–±–æ—Ä–∫–∞ TypeScript
pnpm start                  # –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –≤–µ—Ä—Å–∏–∏

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
pnpm test                   # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pnpm test:watch            # –¢–µ—Å—Ç—ã –≤ —Ä–µ–∂–∏–º–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```typescript
// –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏
bot.ts                      # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –±–æ—Ç–∞
‚îú‚îÄ‚îÄ commands/               # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ handlers/               # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ utils/                  # –£—Ç–∏–ª–∏—Ç—ã
‚îî‚îÄ‚îÄ types/                  # TypeScript —Ç–∏–ø—ã
```

---

_Telegram Bot GAFUS –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —É–¥–æ–±–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–º –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π._
