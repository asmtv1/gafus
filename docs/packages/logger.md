# @gafus/logger - –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

## üìã –û–±–∑–æ—Ä

–ü–∞–∫–µ—Ç `@gafus/logger` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π GAFUS. –ü–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –±–∞–∑–µ **Pino** ‚Äî –æ–¥–Ω–æ–≥–æ –∏–∑ —Å–∞–º—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö Node.js –ª–æ–≥–≥–µ—Ä–æ–≤.

## üéØ –ü–æ—á–µ–º—É —Å–≤–æ–π –ª–æ–≥–≥–µ—Ä, –∞ –Ω–µ Sentry/Datadog?

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–∏—á–∏–Ω–∞–º:

| –ö—Ä–∏—Ç–µ—Ä–∏–π | @gafus/logger | Sentry/Datadog |
|----------|---------------|----------------|
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (self-hosted) | $26+/–º–µ—Å—è—Ü –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è free tier |
| **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–∞–Ω–Ω—ã—Ö** | –ü–æ–ª–Ω—ã–π (—Å–≤–æ—è –ë–î) | –î–∞–Ω–Ω—ã–µ —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ |
| **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** | –ù–∞—Ç–∏–≤–Ω–∞—è –¥–ª—è –º–æ–Ω–æ—Ä–µ–ø–æ | –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| **–ì–∏–±–∫–æ—Å—Ç—å** | –ü–æ–ª–Ω–∞—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | Pino ‚Äî –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç SDK |

### –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–±–æ—Ä –ª–æ–≥–æ–≤/–æ—à–∏–±–æ–∫ –≤ error-dashboard
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ (JSON)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –º–æ–Ω–æ—Ä–µ–ø–æ
- ‚úÖ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–≥–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å–µ—Ä–≤–∏—Å–∞
- ‚úÖ React Error Boundaries (`@gafus/error-handling`)
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –°–±–æ—Ä –ª–æ–≥–æ–≤ –∏–∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ Promtail

### –ß–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

- Source maps –¥–ª—è –∫—Ä–∞—Å–∏–≤—ã—Ö stack traces
- Session replay (–º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å LogRocket –æ—Ç–¥–µ–ª—å–Ω–æ)
- Breadcrumbs (–∏—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π –¥–æ –æ—à–∏–±–∫–∏)

**–í—ã–≤–æ–¥:** –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Sentry/Datadog –Ω–µ –æ–ø—Ä–∞–≤–¥–∞–Ω ‚Äî —Ç–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.

> üìö **–î–µ—Ç–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ:** –°–º. [–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è](docs/architecture/LOGGING_COMPARISON.md) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ LogRocket, self-hosted Sentry –∏ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã.

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
pnpm add @gafus/logger
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–≥–µ—Ä—ã

```typescript
import { 
  createWebLogger,
  createTrainerPanelLogger,
  createWorkerLogger,
  createTelegramBotLogger
} from '@gafus/logger';

// –î–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
const logger = createWebLogger('profile-page');
logger.info('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', { userId: '123' });

// –î–ª—è worker-–æ–≤
const workerLogger = createWorkerLogger('notifications');
workerLogger.error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å push', error);
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∞–±—Ä–∏–∫–∏

| –§–∞–±—Ä–∏–∫–∞ | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | Error Dashboard |
|---------|------------|-----------------|
| `createWebLogger` | web | ‚úÖ –í–∫–ª—é—á–µ–Ω |
| `createTrainerPanelLogger` | trainer-panel | ‚úÖ –í–∫–ª—é—á–µ–Ω |
| `createAdminPanelLogger` | admin-panel | ‚úÖ –í–∫–ª—é—á–µ–Ω |
| `createWorkerLogger` | worker | ‚úÖ –í–∫–ª—é—á–µ–Ω |
| `createTelegramBotLogger` | telegram-bot | ‚úÖ –í–∫–ª—é—á–µ–Ω |
| `createBullBoardLogger` | bull-board | ‚ùå –û—Ç–∫–ª—é—á–µ–Ω |
| `createErrorDashboardLogger` | error-dashboard | ‚ùå –û—Ç–∫–ª—é—á–µ–Ω (–∏–∑–±–µ–∂–∞–Ω–∏–µ —Ä–µ–∫—É—Ä—Å–∏–∏) |
| `createSilentLogger` | ‚Äî | ‚ùå –¢–æ–ª—å–∫–æ fatal |

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
logger.debug('–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏');
logger.info('–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ');
logger.warn('–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –ø—Ä–æ–±–ª–µ–º–µ');
logger.error('–û—à–∏–±–∫–∞', errorObject);
logger.fatal('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞');
```

### –£—Ä–æ–≤–Ω–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

| –û–∫—Ä—É–∂–µ–Ω–∏–µ | –£—Ä–æ–≤–µ–Ω—å |
|-----------|---------|
| development | debug |
| test | warn |
| production | warn |

### –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞–ø—Ä—è–º—É—é

–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—à–∏–±–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `logger.error()` –Ω–∞–ø—Ä—è–º—É—é:

```typescript
import { createWebLogger } from '@gafus/logger';

const logger = createWebLogger('my-context');

// –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—à–∏–±–∫–∏
await logger.error(
  error.message || 'Unknown error',
  error,
  {
    userId: user.id,
    operation: 'checkout',
    additionalContext: { action: 'checkout' },
    tags: ['error', 'checkout'],
  }
);
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
@gafus/logger
‚îú‚îÄ‚îÄ UnifiedLogger       # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å (–æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ Pino)
‚îú‚îÄ‚îÄ LoggerFactory       # –§–∞–±—Ä–∏–∫–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
‚îî‚îÄ‚îÄ ErrorDashboardTransport  # –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Loki
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí Logger ‚Üí Pino ‚Üí Console
                    ‚Üì
              ErrorDashboardTransport ‚Üí error-dashboard ‚Üí PostgreSQL

Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã ‚Üí stdout/stderr ‚Üí Promtail ‚Üí error-dashboard ‚Üí PostgreSQL
```

### –°–±–æ—Ä –ª–æ–≥–æ–≤ –∏–∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

–î–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤ –∏–∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Promtail** ‚Äî –∞–≥–µ–Ω—Ç –¥–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤, –∫–æ—Ç–æ—Ä—ã–π:

1. **–ß–∏—Ç–∞–µ—Ç –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** –∏–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã Docker (`/var/lib/docker/containers/*/*-json.log`)
2. **–ü–∞—Ä—Å–∏—Ç Pino JSON –ª–æ–≥–∏** –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (level, context, app)
3. **–§–∏–ª—å—Ç—Ä—É–µ—Ç –≤–∞–∂–Ω—ã–µ –ª–æ–≥–∏** (warn, error, fatal)
4. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ error-dashboard** —á–µ—Ä–µ–∑ API endpoint `/api/container-logs`

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Promtail:** `ci-cd/docker/promtail/promtail.yml`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –í–∏–¥–∏–º –≤—Å–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –≤ error-dashboard
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ Pino —Ñ–æ—Ä–º–∞—Ç–∞
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã—Ö –ª–æ–≥–æ–≤
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–∏–º—è, ID, app) –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
DISABLE_LOGGING=true              # –ü–æ–ª–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
DISABLE_CONSOLE_LOGGING=true      # –¢–æ–ª—å–∫–æ –∫–æ–Ω—Å–æ–ª—å
DISABLE_ERROR_DASHBOARD_LOGGING=true  # –¢–æ–ª—å–∫–æ dashboard

# URL error-dashboard
ERROR_DASHBOARD_URL=https://monitor.gafus.ru/api
```

### LoggerConfig

```typescript
interface LoggerConfig {
  appName: string;                    // –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  environment: 'development' | 'production' | 'test';
  level: 'debug' | 'info' | 'warn' | 'error' | 'fatal';
  enableConsole?: boolean;            // true –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  enableErrorDashboard?: boolean;     // false –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  context?: string;                   // –ö–æ–Ω—Ç–µ–∫—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'auth-service')
  errorDashboardUrl?: string;         // URL –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
}
```

## üìä –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤

### –í –∫–æ–Ω—Å–æ–ª–∏ (development)
```
[2024-01-15 10:30:45] INFO  [web:profile-page] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ {"userId":"123"}
```

### –í error-dashboard (JSON)
```json
{
  "timestamp": "2024-01-15T10:30:45.123Z",
  "level": "info",
  "appName": "web",
  "context": "profile-page",
  "message": "–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞",
  "metadata": { "userId": "123" },
  "environment": "production"
}
```

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–∞

```
packages/logger/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ UnifiedLogger.ts          # –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–≥–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ LoggerFactory.ts          # –§–∞–±—Ä–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ logger-types.ts           # –¢–∏–ø—ã
‚îÇ   ‚îú‚îÄ‚îÄ transports/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ErrorDashboardTransport.ts
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ tsconfig.json
```

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `pino` ‚Äî –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –ª–æ–≥–≥–µ—Ä
- `@gafus/types` ‚Äî –æ–±—â–∏–µ —Ç–∏–ø—ã

---

*–ü–∞–∫–µ—Ç –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ–¥–∏–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã GAFUS –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö SaaS.*
