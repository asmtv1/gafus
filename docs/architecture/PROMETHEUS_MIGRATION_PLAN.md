# –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Prometheus

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ —Å–∞–º–æ–ø–∏—Å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –º–µ—Ç—Ä–∏–∫, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Prometheus –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏.

---

## üéØ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- `apps/error-dashboard/src/app/api/system-status/route.ts` - `getSystemMetrics()`
- –°–±–æ—Ä —á–µ—Ä–µ–∑ Node.js `os` –º–æ–¥—É–ª—å

**–ß—Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏:**
- ‚úÖ **CPU –º–µ—Ç—Ä–∏–∫–∏**: –∑–∞–≥—Ä—É–∑–∫–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–¥–µ—Ä, –º–æ–¥–µ–ª—å
- ‚úÖ **Memory –º–µ—Ç—Ä–∏–∫–∏**: total, used, free, percentage
- ‚úÖ **Uptime**: –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **Load average**: 1, 5, 15 –º–∏–Ω—É—Ç

**Prometheus —Ä–µ—à–µ–Ω–∏–µ:**
- `node_exporter` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
- –ú–µ—Ç—Ä–∏–∫–∏: `node_cpu_seconds_total`, `node_memory_MemTotal_bytes`, `node_memory_MemAvailable_bytes`, `node_load1`, `node_uptime_seconds`

**–§–∞–π–ª—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è/–∑–∞–º–µ–Ω—ã:**
- `apps/error-dashboard/src/app/api/system-status/route.ts` (—Ñ—É–Ω–∫—Ü–∏—è `getSystemMetrics`)

---

### 2. –ú–µ—Ç—Ä–∏–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ Health Checks (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- `apps/error-dashboard/src/app/api/system-status/route.ts` - `checkServiceStatus()`
- –†—É—á–Ω—ã–µ HTTP –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –ò–∑–º–µ—Ä–µ–Ω–∏–µ response time –≤—Ä—É—á–Ω—É—é

**–ß—Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏:**
- ‚úÖ **–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤**: online/offline
- ‚úÖ **Response time**: –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ health endpoints
- ‚úÖ **Availability**: –ø—Ä–æ—Ü–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- ‚úÖ **HTTP –º–µ—Ç—Ä–∏–∫–∏**: —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤

**Prometheus —Ä–µ—à–µ–Ω–∏–µ:**
- `blackbox_exporter` - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ HTTP endpoints
- –ú–µ—Ç—Ä–∏–∫–∏: `probe_http_status_code`, `probe_http_duration_seconds`, `probe_success`
- –ò–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Next.js —á–µ—Ä–µ–∑ `prom-client`

**–§–∞–π–ª—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è/–∑–∞–º–µ–Ω—ã:**
- `apps/error-dashboard/src/app/api/system-status/route.ts` (—Ñ—É–Ω–∫—Ü–∏—è `checkServiceStatus`)
- Health endpoints –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å, –Ω–æ –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

### 3. –ú–µ—Ç—Ä–∏–∫–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- `apps/error-dashboard/src/app/api/system-status/route.ts` - `checkPostgresStatus()`, `checkRedisStatus()`
- –†—É—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ **PostgreSQL —Å—Ç–∞—Ç—É—Å**: online/offline —á–µ—Ä–µ–∑ `pg_up`
- ‚úÖ **PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π —á–µ—Ä–µ–∑ `pg_stat_database_numbackends`
- ‚úÖ **PostgreSQL –≤–µ—Ä—Å–∏—è**: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ `pg_stat_database_version`
- ‚úÖ **Redis —Å—Ç–∞—Ç—É—Å**: online/offline —á–µ—Ä–µ–∑ `redis_up`
- ‚úÖ **Redis –≤–µ—Ä—Å–∏—è**: —á–µ—Ä–µ–∑ `redis_info_redis_version`
- ‚úÖ **Response time**: –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ Prometheus API

**Prometheus —Ä–µ—à–µ–Ω–∏–µ:**
- `postgres_exporter` - –¥–ª—è PostgreSQL –º–µ—Ç—Ä–∏–∫
- `redis_exporter` - –¥–ª—è Redis –º–µ—Ç—Ä–∏–∫
- –ú–µ—Ç—Ä–∏–∫–∏: `pg_up`, `pg_stat_database_numbackends`, `pg_stat_database_version`, `redis_up`, `redis_info_redis_version`

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `apps/error-dashboard/src/app/api/system-status/route.ts` (—Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–¥–µ–ª–∞–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Prometheus)
- ‚úÖ `apps/error-dashboard/src/shared/lib/prometheus.ts` (–¥–æ–±–∞–≤–ª–µ–Ω—ã `getPostgresMetricsFromPrometheus`, `getRedisMetricsFromPrometheus`)
- ‚úÖ `ci-cd/docker/docker-compose.prod.yml` (–¥–æ–±–∞–≤–ª–µ–Ω—ã —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã)
- ‚úÖ `ci-cd/docker/docker-compose.local.yml` (–¥–æ–±–∞–≤–ª–µ–Ω—ã —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- ‚úÖ `ci-cd/docker/prometheus/prometheus.yml` (–¥–æ–±–∞–≤–ª–µ–Ω—ã job'—ã –¥–ª—è –ë–î)

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- –°–º. `docs/architecture/PROMETHEUS_DB_METRICS.md` –¥–ª—è –¥–µ—Ç–∞–ª–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

### 4. –ú–µ—Ç—Ä–∏–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π BullMQ (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- `apps/error-dashboard/src/app/api/queues/stats/route.ts` - `getQueueStats()`
- –†—É—á–Ω–æ–π —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —á–µ—Ä–µ–∑ BullMQ API

**–ß—Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏:**
- ‚úÖ **–†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–µ–π**: waiting, active, completed, failed, delayed
- ‚úÖ **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏**: —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á
- ‚úÖ **Throughput**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –≤ —Å–µ–∫—É–Ω–¥—É
- ‚úÖ **Error rate**: –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∑–∞–¥–∞—á
- ‚úÖ **Retry rate**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- ‚úÖ **Job duration**: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á

**Prometheus —Ä–µ—à–µ–Ω–∏–µ:**
- `bullmq-prometheus` –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä
- –ú–µ—Ç—Ä–∏–∫–∏: `bullmq_queue_size{queue="push",state="waiting"}`, `bullmq_job_duration_seconds`, `bullmq_job_failures_total`

**–§–∞–π–ª—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è/–∑–∞–º–µ–Ω—ã:**
- `apps/error-dashboard/src/app/api/queues/stats/route.ts` (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è UI, –Ω–æ –¥–∞–Ω–Ω—ã–µ –±—Ä–∞—Ç—å –∏–∑ Prometheus)

---

### 5. –ú–µ—Ç—Ä–∏–∫–∏ –æ—à–∏–±–æ–∫ (–°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- `packages/error-handling/src/core/metrics.ts` - `MetricsCollector` –∫–ª–∞—Å—Å
- `apps/error-dashboard/src/shared/lib/actions/errors.ts` - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
- In-memory –∫–æ–ª–ª–µ–∫—Ç–æ—Ä –º–µ—Ç—Ä–∏–∫

**–ß—Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏:**
- ‚úÖ **Error count**: –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- ‚úÖ **Error rate**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –≤ —Å–µ–∫—É–Ω–¥—É
- ‚úÖ **Error by type**: –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫
- ‚úÖ **Error by app**: –æ—à–∏–±–∫–∏ –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º
- ‚úÖ **Error by environment**: –æ—à–∏–±–∫–∏ –ø–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º
- ‚úÖ **Most common errors**: —Ç–æ–ø –æ—à–∏–±–æ–∫

**Prometheus —Ä–µ—à–µ–Ω–∏–µ:**
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏ —á–µ—Ä–µ–∑ `prom-client`
- –ú–µ—Ç—Ä–∏–∫–∏: `http_errors_total{app="web",type="server_error"}`, `error_rate{app="trainer-panel"}`

**–§–∞–π–ª—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è/–∑–∞–º–µ–Ω—ã:**
- `packages/error-handling/src/core/metrics.ts` (–∫–ª–∞—Å—Å `MetricsCollector` - –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Prometheus –∫–ª–∏–µ–Ω—Ç)
- Error Dashboard –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞, –Ω–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –±—Ä–∞—Ç—å –∏–∑ Prometheus

---

### 6. –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Web Vitals) (–°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- `packages/error-handling/src/core/metrics.ts` - `PerformanceMetrics` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- In-memory —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ß—Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏:**
- ‚úÖ **Page Load Time**: –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ **First Contentful Paint (FCP)**: –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ **Largest Contentful Paint (LCP)**: –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∞–º–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
- ‚úÖ **Cumulative Layout Shift (CLS)**: —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≤–µ—Ä—Å—Ç–∫–∏
- ‚úÖ **First Input Delay (FID)**: –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- ‚úÖ **Time to First Byte (TTFB)**: –≤—Ä–µ–º—è –¥–æ –ø–µ—Ä–≤–æ–≥–æ –±–∞–π—Ç–∞

**Prometheus —Ä–µ—à–µ–Ω–∏–µ:**
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ `prom-client` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ò–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ `/metrics` endpoint —á–µ—Ä–µ–∑ Server Actions
- –ú–µ—Ç—Ä–∏–∫–∏: `web_vitals_fcp_seconds`, `web_vitals_lcp_seconds`, `web_vitals_cls`

**–§–∞–π–ª—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è/–∑–∞–º–µ–Ω—ã:**
- `packages/error-handling/src/core/metrics.ts` (–º–µ—Ç–æ–¥—ã `getPerformanceMetrics`, `recordMetric`)

---

### 7. –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ Re-engagement (–ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- `packages/reengagement/src/metrics.ts` - `recordDailyMetrics()`
- –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —á–µ—Ä–µ–∑ `ReengagementMetrics` –º–æ–¥–µ–ª—å

**–ß—Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏:**
- ‚úÖ **–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π
- ‚úÖ **–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**: –ø–æ –¥–Ω—è–º, —É—Ä–æ–≤–Ω—è–º, —Ç–∏–ø–∞–º
- ‚úÖ **–í–µ—Ä–Ω—É–ª–æ—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- ‚úÖ **Click rate**: –ø—Ä–æ—Ü–µ–Ω—Ç –∫–ª–∏–∫–æ–≤
- ‚úÖ **Return rate**: –ø—Ä–æ—Ü–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- ‚úÖ **Open rate**: –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–∫—Ä—ã—Ç–∏–π (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

**Prometheus —Ä–µ—à–µ–Ω–∏–µ:**
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ `prom-client`
- –ú–µ—Ç—Ä–∏–∫–∏: `reengagement_campaigns_active`, `reengagement_notifications_sent_total{level="1"}`, `reengagement_return_rate`

**–§–∞–π–ª—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è/–∑–∞–º–µ–Ω—ã:**
- `packages/reengagement/src/metrics.ts` (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î, –Ω–æ real-time –º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus)

---

### 8. –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫—É—Ä—Å–æ–≤ (–ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- `packages/statistics/src/course/statistics.ts` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞ –ª–µ—Ç—É
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

**–ß—Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏:**
- ‚úÖ **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É—Ä—Å–æ–≤**: –æ–±—â–µ–µ, –∞–∫—Ç–∏–≤–Ω—ã—Ö, –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö
- ‚úÖ **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –ø–æ –∫—É—Ä—Å–∞–º, –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- ‚úÖ **–ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: completion rate
- ‚úÖ **–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è**: —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞ –∫—É—Ä—Å
- ‚úÖ **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏**: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å–∞–º**: –ø–∏–∫–æ–≤—ã–µ —á–∞—Å—ã

**Prometheus —Ä–µ—à–µ–Ω–∏–µ:**
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ `prom-client`
- –ú–µ—Ç—Ä–∏–∫–∏: `courses_total`, `courses_users_total{course_id="123",status="completed"}`, `courses_completion_rate`

**–§–∞–π–ª—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è/–∑–∞–º–µ–Ω—ã:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—É—Ä—Å–æ–≤ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –ë–î –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞, –Ω–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –º–æ–∂–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –≤ Prometheus

---

### 9. HTTP –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ù–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–±–æ—Ä–∞ HTTP –º–µ—Ç—Ä–∏–∫
- Health endpoints —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞

**–ß—Ç–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- ‚úÖ **HTTP requests total**: –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **HTTP request duration**: –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **HTTP status codes**: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∞–º
- ‚úÖ **Request size**: —Ä–∞–∑–º–µ—Ä –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **Response size**: —Ä–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ **Active connections**: –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

**Prometheus —Ä–µ—à–µ–Ω–∏–µ:**
- `prom-client` middleware –¥–ª—è Next.js
- –ú–µ—Ç—Ä–∏–∫–∏: `http_requests_total{method="GET",route="/api/users",status="200"}`, `http_request_duration_seconds`

**–§–∞–π–ª—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:**
- Middleware –¥–ª—è –≤—Å–µ—Ö Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (web, trainer-panel, admin-panel, error-dashboard)

---

### 10. –ú–µ—Ç—Ä–∏–∫–∏ Prisma (–°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ –¥–ª—è Prisma –∑–∞–ø—Ä–æ—Å–æ–≤

**–ß—Ç–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- ‚úÖ **Query duration**: –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **Query count**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–∏–ø–∞–º
- ‚úÖ **Connection pool**: —Ä–∞–∑–º–µ—Ä –ø—É–ª–∞, –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- ‚úÖ **Slow queries**: –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (> 1 —Å–µ–∫—É–Ω–¥—ã)
- ‚úÖ **Query errors**: –æ—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

**Prometheus —Ä–µ—à–µ–Ω–∏–µ:**
- Prisma middleware –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫
- –ú–µ—Ç—Ä–∏–∫–∏: `prisma_query_duration_seconds{model="User",operation="findMany"}`, `prisma_query_total`

**–§–∞–π–ª—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:**
- Prisma middleware –≤ `packages/prisma/src/client.ts`

---

## üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª | Prometheus —Ä–µ—à–µ–Ω–∏–µ | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|-----------|-----------|--------------|---------------------|-----------|
| –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ | –í–´–°–û–ö–ò–ô | `system-status/route.ts` | `node_exporter` | –ù–∏–∑–∫–∞—è |
| Health Checks | –í–´–°–û–ö–ò–ô | `system-status/route.ts` | `blackbox_exporter` | –ù–∏–∑–∫–∞—è |
| PostgreSQL | –í–´–°–û–ö–ò–ô | `system-status/route.ts` | `postgres_exporter` | –ù–∏–∑–∫–∞—è |
| Redis | –í–´–°–û–ö–ò–ô | `system-status/route.ts` | `redis_exporter` | –ù–∏–∑–∫–∞—è |
| BullMQ –æ—á–µ—Ä–µ–¥–∏ | –í–´–°–û–ö–ò–ô | `queues/stats/route.ts` | `bullmq-prometheus` | –°—Ä–µ–¥–Ω—è—è |
| HTTP –º–µ—Ç—Ä–∏–∫–∏ | –í–´–°–û–ö–ò–ô | –ù–µ—Ç | `prom-client` middleware | –°—Ä–µ–¥–Ω—è—è |
| –ú–µ—Ç—Ä–∏–∫–∏ –æ—à–∏–±–æ–∫ | –°–†–ï–î–ù–ò–ô | `error-handling/metrics.ts` | `prom-client` | –°—Ä–µ–¥–Ω—è—è |
| Web Vitals | –°–†–ï–î–ù–ò–ô | `error-handling/metrics.ts` | `prom-client` | –°—Ä–µ–¥–Ω—è—è |
| Prisma –º–µ—Ç—Ä–∏–∫–∏ | –°–†–ï–î–ù–ò–ô | –ù–µ—Ç | Prisma middleware | –°—Ä–µ–¥–Ω—è—è |
| Re-engagement | –ù–ò–ó–ö–ò–ô | `reengagement/metrics.ts` | `prom-client` | –ù–∏–∑–∫–∞—è |
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—É—Ä—Å–æ–≤ | –ù–ò–ó–ö–ò–ô | `statistics/course/statistics.ts` | `prom-client` | –ù–∏–∑–∫–∞—è |

---

## üöÄ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ù–µ–¥–µ–ª—è 1)
1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Prometheus –≤ Docker
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑–æ–≤—ã—Ö —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–≤:
   - `node_exporter`
   - `postgres_exporter`
   - `redis_exporter`
   - `blackbox_exporter`

### –≠—Ç–∞–ø 2: –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–ù–µ–¥–µ–ª—è 2)
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `node_exporter` –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `postgres_exporter` –∏ `redis_exporter`
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `blackbox_exporter` –¥–ª—è health checks
4. –£–¥–∞–ª–µ–Ω–∏–µ —Å–∞–º–æ–ø–∏—Å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏–∑ `system-status/route.ts`

### –≠—Ç–∞–ø 3: –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–ù–µ–¥–µ–ª—è 3-4)
1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `prom-client` –≤–æ –≤—Å–µ Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –°–æ–∑–¥–∞–Ω–∏–µ `/metrics` endpoints
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTP –º–µ—Ç—Ä–∏–∫ —á–µ—Ä–µ–∑ middleware
4. –ú–∏–≥—Ä–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –≠—Ç–∞–ø 4: –ú–µ—Ç—Ä–∏–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π (–ù–µ–¥–µ–ª—è 5)
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–∞ –¥–ª—è BullMQ
2. –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—á–µ—Ä–µ–¥—è–º–∏

### –≠—Ç–∞–ø 5: –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ (–ù–µ–¥–µ–ª—è 6)
1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ re-engagement
2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫—É—Ä—Å–æ–≤
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∞—à–±–æ—Ä–¥–æ–≤ –≤ Grafana

### –≠—Ç–∞–ø 6: –ê–ª–µ—Ä—Ç–∏–Ω–≥ (–ù–µ–¥–µ–ª—è 7)
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Alertmanager
2. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∞–ª–µ—Ä—Ç–æ–≤
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ (Telegram, Email)

---

## üì¶ –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã

```json
{
  "dependencies": {
    "prom-client": "^15.0.0"
  }
}
```

## üê≥ Docker —Å–µ—Ä–≤–∏—Å—ã

```yaml
services:
  prometheus:
    image: prom/prometheus:latest
    volumes:
      - ./prometheus:/etc/prometheus
    ports:
      - "9090:9090"
  
  grafana:
    image: grafana/grafana:latest
    ports:
      - "3003:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
  
  node-exporter:
    image: prom/node-exporter:latest
    ports:
      - "9100:9100"
  
  postgres-exporter:
    image: prometheuscommunity/postgres-exporter:latest
    environment:
      - DATA_SOURCE_NAME=postgresql://user:pass@postgres:5432/dbname
  
  redis-exporter:
    image: oliver006/redis_exporter:latest
    environment:
      - REDIS_ADDR=redis:6379
  
  blackbox-exporter:
    image: prom/blackbox-exporter:latest
    ports:
      - "9115:9115"
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

1. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤
2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: Prometheus –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö
3. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–º–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º–∏ (Thanos, Cortex)
4. **–ú–æ—â–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: PromQL –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
5. **–≠–∫–æ—Å–∏—Å—Ç–µ–º–∞**: –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≥–æ—Ç–æ–≤—ã—Ö —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–≤ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
6. **–ê–ª–µ—Ä—Ç–∏–Ω–≥**: –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤ —á–µ—Ä–µ–∑ Alertmanager
7. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Grafana –¥–ª—è –∫—Ä–∞—Å–∏–≤—ã—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤
8. **–ú–µ–Ω—å—à–µ –∫–æ–¥–∞**: —É–¥–∞–ª–µ–Ω–∏–µ —Å–∞–º–æ–ø–∏—Å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

---

## ‚ö†Ô∏è –ß—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç—å –≤ –ë–î

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ª—É—á—à–µ –æ—Å—Ç–∞–≤–∏—Ç—å –≤ –ë–î –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:
- **–î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏**: –ø–æ–ª–Ω—ã–µ stack traces, –∫–æ–Ω—Ç–µ–∫—Å—Ç
- **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏**: –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–Ω–¥–æ–≤
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ**: –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- **–õ–æ–≥–∏**: –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Loki)

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- Error Dashboard –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—à–∏–±–æ–∫
- Bull Board –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏
- Prometheus –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞
- Grafana –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫

