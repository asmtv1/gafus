# ADR: Формат идентификаторов сущностей (CUID)

## Status

Accepted

## Context

В проекте возникла несогласованность форматов ID: часть валидации API принимает UUID, в БД используется CUID, документация смешивает оба формата. Это создаёт путаницу, повышает вероятность ошибок валидации и усложняет поддержку.

## Decision

Устанавливаем **CUID v1** как единственный канонический формат для идентификаторов всех бизнес-сущностей (DayOnCourse, Course, UserStep, Step, TrainingDay и т.д.).

### Исключения

- `RefreshToken.id`: UUID — требование библиотеки JWT refresh
- `StepNotification.id`: UUID — совместимость с Redis queue job IDs

## Consequences

### Positive

- Единая валидация на границе API (Zod `.cuid()`)
- Нет ветвления по формату в бизнес-логике
- Консистентность с Prisma `@default(cuid())`
- Чёткая документация формата в контрактах

### Negative

- Отказ от UUID ломает совместимость, если когда-то были UUID в ID сущностей (по коду не обнаружено)

### Implementation

- Валидация формата — только на границе (API routes, Server Actions)
- Core-слой получает уже провалидированные строки
- В Zod: `z.string().cuid("message")` (CUID v1, не cuid2)
