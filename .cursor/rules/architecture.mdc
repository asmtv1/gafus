---
alwaysApply: true
---

# Project Architecture Rules

## Monorepo Structure
- This is a **pnpm workspace** monorepo with Turborepo
- Apps: `apps/` (web, trainer-panel, error-dashboard, admin-panel, telegram-bot, bull-board, api, mobile)
- Packages: `packages/` (shared libraries)
- Always use workspace protocol: `"@gafus/package": "workspace:*"`

## Package Organization
```
packages/
├── auth/           # Authentication & authorization
├── core/           # Business logic, services
├── cdn-upload/     # CDN uploads
├── csrf/           # CSRF protection
├── error-handling/ # Error reporting, ErrorBoundary
├── logger/         # Logging (Pino, error-dashboard transport)
├── metadata/       # SEO metadata, JSON-LD
├── prisma/         # Database & ORM
├── queues/         # BullMQ queues
├── react-query/    # React Query hooks & provider
├── reengagement/   # Reengagement emails
├── statistics/     # Course/user statistics
├── types/          # Shared TypeScript types
├── ui-components/  # Shared UI (e.g. LoginForm)
├── video-access/   # Video access & signing
├── webpush/        # Push notifications
└── worker/         # Background jobs
```

## App Structure (Next.js 15 App Router)
Used in apps/web, apps/trainer-panel and other Next apps:
```
src/
├── app/            # Routes, (main)/(auth) groups, API routes
├── features/      # Feature modules (FSD-like)
│   └── [feature]/
│       ├── components/
│       ├── lib/    # Feature logic, server actions
│       └── types/
├── shared/        # Shared across features
│   ├── components/
│   ├── lib/
│   ├── hooks/
│   └── ...        # types, providers, stores, utils, styles (app-specific)
└── middleware.ts
```
Some apps may have root-level `src/types` or `src/utils`.

## Best Practices
- Keep features isolated and self-contained
- Shared code in `shared/` or workspace packages
- Server actions / client boundaries — see `nextjs.mdc`, `react.mdc`
