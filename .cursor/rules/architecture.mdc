---
alwaysApply: true
---

# Project Architecture Rules

## Monorepo Structure
- This is a **pnpm workspace** monorepo with Turborepo
- Apps: `apps/` (web, trainer-panel, error-dashboard, telegram-bot, bull-board)
- Packages: `packages/` (shared libraries)
- Always use workspace protocol: `"@gafus/package": "workspace:*"`

## Package Organization
```
packages/
├── auth/           # Authentication & authorization
├── core/           # Business logic, services
├── cdn-upload/     # CDN uploads
├── csrf/           # CSRF protection
├── error-handling/ # Error reporting, ErrorBoundary
├── logger/         # Logging (Pino, error-dashboard transport)
├── metadata/       # SEO metadata, JSON-LD
├── prisma/         # Database & ORM
├── queues/         # BullMQ queues
├── react-query/    # React Query hooks & provider
├── reengagement/   # Reengagement emails
├── statistics/     # Course/user statistics
├── types/          # Shared TypeScript types
├── ui-components/  # Shared UI (e.g. LoginForm)
├── video-access/   # Video access & signing
├── webpush/        # Push notifications
└── worker/         # Background jobs
```

## App Structure (Next.js 15 App Router)
```
src/
├── app/            # Next.js App Router pages
├── features/       # Feature modules (FSD-like)
│   └── [feature]/
│       ├── components/  # Feature-specific components
│       ├── lib/         # Feature-specific logic
│       └── types/       # Feature-specific types
├── shared/         # Shared across features
│   ├── components/ # Reusable UI components
│   ├── lib/        # Utilities & helpers
│   └── hooks/      # Custom React hooks
└── middleware.ts   # Next.js middleware
```

## Best Practices
- Keep features isolated and self-contained
- Shared code goes in `shared/` or workspace packages
- Server actions in `lib/` directory with "use server" directive
- Client components explicitly marked with "use client"
