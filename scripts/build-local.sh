#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏ –∫–∞–∫ –≤ CI
# –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ –∂–µ –∫–æ–º–∞–Ω–¥—ã, —á—Ç–æ –∏ –≤ .github/workflows/ci-cd.yml

set -e

echo "üî® –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏ (–∫–∞–∫ –≤ CI)..."
echo "=================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –º—ã –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
if [ ! -f "package.json" ] || [ ! -f "pnpm-lock.yaml" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞"
    exit 1
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–∫–∞–∫ –≤ CI)
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
pnpm install

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º Prisma Client (–∫–∞–∫ –≤ CI - –¢–û–ß–ù–û –¢–ê–ö –ñ–ï!)
echo "üóÑÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client..."
cd packages/prisma
pnpm db:generate
cd ../..

# –°–æ–±–∏—Ä–∞–µ–º web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–∫–∞–∫ –≤ CI)
echo "üåê –°–±–æ—Ä–∫–∞ web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
cd apps/web
pnpm build
cd ../..

# –°–æ–±–∏—Ä–∞–µ–º trainer-panel (–∫–∞–∫ –≤ CI)
echo "üë®‚Äçüè´ –°–±–æ—Ä–∫–∞ trainer-panel..."
cd apps/trainer-panel
pnpm build
cd ../..

# –°–æ–±–∏—Ä–∞–µ–º error-dashboard (–∫–∞–∫ –≤ CI)
echo "üìä –°–±–æ—Ä–∫–∞ error-dashboard..."
cd apps/error-dashboard
pnpm build
cd ../..

# –ù–ï —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø–∞–∫–µ—Ç—ã - –≤ CI —ç—Ç–æ–≥–æ –Ω–µ—Ç!
# –í CI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ pnpm build –≤ –∫–∞–∂–¥–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
echo "üì¶ –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä–∫—É –ø–∞–∫–µ—Ç–æ–≤ (–≤ CI —ç—Ç–æ–≥–æ –Ω–µ—Ç!)"

echo "=================================="
echo "‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
echo "üéØ –¢–µ–ø–µ—Ä—å –ª–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ —Ç–æ—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç CI"
echo "üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º!"

echo "=================================="
echo "‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
echo "üéØ –¢–µ–ø–µ—Ä—å –ª–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ —Ç–æ—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç CI"
