# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–µ–π - Hydration Fix

## üö® **–ü—Ä–æ–±–ª–µ–º–∞**

–û—à–∏–±–∫–∞ –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏ –≤ Next.js:

```
Error: Hydration failed because the server rendered text didn't match the client.
```

–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

## üîç **–ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã**

### **–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **–§—É–Ω–∫—Ü–∏–∏, –∑–∞–≤–∏—Å—è—â–∏–µ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏** - `Date.now()`, `Math.random()`
2. **–ë—Ä–∞—É–∑–µ—Ä–Ω—ã–µ API** - `window`, `navigator`, `localStorage`
3. **–†–∞–∑–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –∫–ª–∏–µ–Ω—Ç–µ**
4. **–£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å `typeof window !== 'undefined'`**

### **–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

- `CSRFStatus` - `isTokenValid()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Date.now()`
- `NotificationStatus` - `isSupported()`, `isGranted()`, `canRequest()`
- `CSRFTest` - `isTokenValid()`, `getTokenAge()`
- `Profile/NotificationStatus` - `isSupported()`, `isGranted()`

## ‚úÖ **–†–µ—à–µ–Ω–∏–µ**

### **1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

–ò—Å–ø–æ–ª—å–∑—É–µ–º `useState` –∏ `useEffect` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:

```tsx
const [mounted, setMounted] = useState(false);

useEffect(() => {
  setMounted(true);
}, []);
```

### **2. –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥**

–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```tsx
// ‚ùå –ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥
<div>Valid: {isTokenValid() ? 'true' : 'false'}</div>

// ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥
<div>Valid: {mounted && isTokenValid() ? 'true' : 'false'}</div>
```

## üîß **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**

### **1. CSRFStatus.tsx**

```tsx
const [mounted, setMounted] = useState(false);

useEffect(() => {
  setMounted(true);
}, []);

const isValid = mounted ? isTokenValid() : false;
```

### **2. NotificationStatus.tsx**

```tsx
const [mounted, setMounted] = useState(false);

useEffect(() => {
  setMounted(true);
}, []);

// –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–Ω–æ–ø–æ–∫
{
  mounted && <div className={styles.actions}>{/* –∫–Ω–æ–ø–∫–∏ */}</div>;
}
```

### **3. CSRFTest.tsx**

```tsx
const [mounted, setMounted] = useState(false);

useEffect(() => {
  setMounted(true);
}, []);

// –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
{
  mounted && getTokenAge() && <div>Age: {Math.round(getTokenAge()! / 1000)}s</div>;
}
```

### **4. Profile/NotificationStatus.tsx**

```tsx
const [mounted, setMounted] = useState(false);

useEffect(() => {
  setMounted(true);
}, []);

// –£—Å–ª–æ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
if (mounted && !isSupported()) {
  return <div>–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>;
}
```

## üìã **–ü–∞—Ç—Ç–µ—Ä–Ω —Ä–µ—à–µ–Ω–∏—è**

### **–®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

```tsx
const [mounted, setMounted] = useState(false);

useEffect(() => {
  setMounted(true);
}, []);
```

### **–®–∞–≥ 2: –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥**

```tsx
// –î–ª—è –∑–Ω–∞—á–µ–Ω–∏–π, –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞
{
  value: mounted ? clientValue : defaultValue;
}

// –î–ª—è —É—Å–ª–æ–≤–Ω—ã—Ö –±–ª–æ–∫–æ–≤
{
  mounted && <div>{/* –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç */}</div>;
}
```

### **–®–∞–≥ 3: –£—Å–ª–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**

```tsx
// –î–ª—è —Ñ—É–Ω–∫—Ü–∏–π, –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞
if (mounted && !isSupported()) {
  return <div>–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</div>;
}
```

## üéØ **–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã**

### **1. –°–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥**

- –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ API
- –ù–µ –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

### **2. –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥**

- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `mounted` —Ñ–ª–∞–≥ –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ API –±–µ–∑–æ–ø–∞—Å–Ω–æ

### **3. –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥**

- –ù–∞—á–∏–Ω–∞–µ–º —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ä–µ–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ—Å–ª–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò–∑–±–µ–≥–∞–µ–º –º–µ—Ä—Ü–∞–Ω–∏—è –∏ –ø—Ä—ã–∂–∫–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

## üöÄ **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- ‚ùå –û—à–∏–±–∫–∏ –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏
- ‚ùå –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–µ—Ä–≤–µ—Ä/–∫–ª–∏–µ–Ω—Ç
- ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏—è
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ SSR
- ‚úÖ –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã

## üìö **–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏**

- [Next.js Hydration Error](https://nextjs.org/docs/messages/react-hydration-error)
- [React Hydration Mismatch](https://react.dev/link/hydration-mismatch)
- [SSR vs CSR](https://nextjs.org/docs/app/building-your-application/rendering)

## üîç **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**

### **–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
npm run typecheck

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
npm run build

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev
```

### **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:**

1. ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
2. ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ SSR
4. ‚úÖ –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
