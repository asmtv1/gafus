# üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ Service Worker

## –ü—Ä–æ–±–ª–µ–º–∞

–û—à–∏–±–∫–∏ Service Worker –Ω–µ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫ `@http://errors.gafus.localhost/` –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–∏—á–∏–Ω–∞–º:

### 1. **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**

- Service Worker —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
- –ù–µ —Å–≤—è–∑–∞–Ω —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
- –ò–º–µ–µ—Ç —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 2. **–¢–∏–ø—ã –æ—à–∏–±–æ–∫**

- `A listener indicated an asynchronous response by returning true, but the message channel closed before a response was received`
- –≠—Ç–æ –Ω–µ JavaScript –æ—à–∏–±–∫–∞, –∞ –æ—à–∏–±–∫–∞ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ SW
- –ù–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏

### 3. **–§–æ–Ω–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**

- –û—à–∏–±–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
- –ù–µ –≤–∏–¥–Ω—ã –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- –ù–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫

## –†–µ—à–µ–Ω–∏–µ

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è Service Worker

#### 1. **ErrorReporter –¥–ª—è SW**

```javascript
const errorReporter = {
  async reportError(error, context = {}) {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫–∏ –≤ –¥–∞—à–±–æ—Ä–¥
    await fetch("/api/report", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message: error.message,
        stack: error.stack,
        context: { ...context, serviceWorker: true },
      }),
    });
  },
};
```

#### 2. **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫**

```javascript
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
self.addEventListener("error", (event) => {
  errorReporter.reportError(event.error, {
    event: "error",
    filename: event.filename,
    lineno: event.lineno,
  });
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π –ø—Ä–æ–º–∏—Å–æ–≤
self.addEventListener("unhandledrejection", (event) => {
  errorReporter.reportError(new Error(event.reason), {
    event: "unhandledrejection",
  });
});
```

#### 3. **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—à–∏–±–æ–∫ –∫–∞–Ω–∞–ª–∞ —Å–≤—è–∑–∏**

```javascript
// –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ —Å –∑–∞–∫—Ä—ã—Ç—ã–º –∫–∞–Ω–∞–ª–æ–º
const originalPostMessage = MessagePort.prototype.postMessage;
MessagePort.prototype.postMessage = function (message, transfer) {
  try {
    return originalPostMessage.call(this, message, transfer);
  } catch (error) {
    if (error.message.includes("message channel closed")) {
      errorReporter.reportError(error, {
        type: "message_channel_error",
      });
    }
    throw error;
  }
};
```

#### 4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π**

```javascript
// –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–ª–æ–≤–∞ –æ—à–∏–±–æ–∫
wrapAsync(fn) {
  return async (...args) => {
    try {
      return await fn(...args);
    } catch (error) {
      await this.reportError(error, {
        function: fn.name || 'anonymous'
      });
      throw error;
    }
  };
}
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –≤—Å–µ –æ—à–∏–±–∫–∏ Service Worker –±—É–¥—É—Ç:

1. **–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ –¥–∞—à–±–æ—Ä–¥** `@http://errors.gafus.localhost/`
2. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
3. **–°–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç** –æ —Ç–æ–º, —á—Ç–æ –æ—à–∏–±–∫–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –≤ SW
4. **–í–∫–ª—é—á–∞—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** –æ —Å–æ–±—ã—Ç–∏–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö

## üìä –¢–∏–ø—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –æ—à–∏–±–æ–∫

- ‚ùå –û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ Workbox
- ‚ùå –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚ùå –û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –û—à–∏–±–∫–∏ –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚ùå –û—à–∏–±–∫–∏ –∫–ª–∏–∫–∞ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º
- ‚ùå –û—à–∏–±–∫–∏ —Ä–µ–ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ push
- ‚ùå –û—à–∏–±–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏
- ‚ùå –û—à–∏–±–∫–∏ —Å –∑–∞–∫—Ä—ã—Ç—ã–º –∫–∞–Ω–∞–ª–æ–º —Å–≤—è–∑–∏
- ‚ùå –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –ø—Ä–æ–º–∏—Å–æ–≤

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Service Worker –≤—Å–µ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—à–±–æ—Ä–¥ –ø–æ –∞–¥—Ä–µ—Å—É:

**http://errors.gafus.localhost/**

## üìù –õ–æ–≥–∏

–û—à–∏–±–∫–∏ Service Worker –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å —Ç–µ–≥–æ–º `serviceWorker: true` –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –æ —Ç–∏–ø–µ —Å–æ–±—ã—Ç–∏—è.
