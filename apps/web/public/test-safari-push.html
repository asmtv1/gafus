<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–¢–µ—Å—Ç Safari Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }
      .status {
        padding: 15px;
        margin: 15px 0;
        border-radius: 8px;
        font-weight: 500;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .warning {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      .info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      button {
        background-color: #007AFF;
        color: white;
        border: none;
        padding: 12px 24px;
        margin: 8px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
      }
      button:hover {
        background-color: #0056CC;
      }
      button:disabled {
        background-color: #8E8E93;
        cursor: not-allowed;
      }
      .log {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
        max-height: 400px;
        overflow-y: auto;
        font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
        font-size: 13px;
        line-height: 1.4;
      }
      .ios-specific {
        background-color: #f0f8ff;
        border: 1px solid #b3d9ff;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
      }
      .step {
        margin: 20px 0;
        padding: 15px;
        border-left: 4px solid #007AFF;
        background-color: #f8f9fa;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üçé –¢–µ—Å—Ç Safari Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h1>
      
      <div class="ios-specific">
        <h3>üì± iOS Safari –°–ø–µ—Ü–∏—Ñ–∏–∫–∞</h3>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Safari –Ω–∞ iOS.</p>
        <p><strong>–í–∞–∂–Ω–æ:</strong> –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Safari –¥–æ–±–∞–≤—å—Ç–µ —Å–∞–π—Ç –≤ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω.</p>
      </div>

      <div id="status" class="status info">–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å...</div>

      <div class="step">
        <h3>–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</h3>
        <button id="checkSupport">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É</button>
        <button id="checkIOS">üçé –ü—Ä–æ–≤–µ—Ä–∏—Ç—å iOS</button>
      </div>

      <div class="step">
        <h3>–®–∞–≥ 2: –†–∞–∑—Ä–µ—à–µ–Ω–∏—è</h3>
        <button id="requestPermission">üîî –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ</button>
        <button id="checkPermission">üìã –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è</button>
      </div>

      <div class="step">
        <h3>–®–∞–≥ 3: Service Worker</h3>
        <button id="checkSW">‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SW</button>
        <button id="testSW">üß™ –¢–µ—Å—Ç SW</button>
      </div>

      <div class="step">
        <h3>–®–∞–≥ 4: Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
        <button id="testNotification">üîî –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
        <button id="testPush">üöÄ –¢–µ—Å—Ç Push</button>
        <button id="testSafariSpecific">üçé Safari —Ç–µ—Å—Ç</button>
        <button id="createSafariSubscription">üçé –°–æ–∑–¥–∞—Ç—å Safari –ø–æ–¥–ø–∏—Å–∫—É</button>
      </div>

      <div class="step">
        <h3>–£—Ç–∏–ª–∏—Ç—ã</h3>
        <button id="clearLog">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        <button id="fullCheck">üöÄ –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</button>
      </div>

      <div class="log" id="log"></div>
    </div>

    <script>
      const log = document.getElementById("log");
      const status = document.getElementById("status");

      function addLog(message, type = "info") {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement("div");
        logEntry.innerHTML = `[${timestamp}] ${message}`;
        logEntry.style.color = type === "error" ? "#FF3B30" : type === "success" ? "#34C759" : type === "warning" ? "#FF9500" : "#007AFF";
        log.appendChild(logEntry);
        log.scrollTop = log.scrollHeight;
      }

      function updateStatus(message, type = "info") {
        status.textContent = message;
        status.className = `status ${type}`;
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ iOS Safari
      function checkIOS() {
        addLog("üçé –ü—Ä–æ–≤–µ—Ä—è–µ–º iOS Safari...");
        
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isSafari = /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent);
        const isStandalone = window.navigator.standalone;
        
        if (isIOS && isSafari) {
          addLog("‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω iOS Safari", "success");
          addLog(`üì± iOS –≤–µ—Ä—Å–∏—è: ${navigator.userAgent.match(/OS (\d+)_/)?.[1] || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞"}`, "info");
          
          if (isStandalone) {
            addLog("‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ standalone —Ä–µ–∂–∏–º–µ (PWA)", "success");
          } else {
            addLog("‚ö†Ô∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï –≤ standalone —Ä–µ–∂–∏–º–µ", "warning");
            addLog("üí° –î–ª—è –ª—É—á—à–µ–π —Ä–∞–±–æ—Ç—ã push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–æ–±–∞–≤—å—Ç–µ —Å–∞–π—Ç –≤ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω", "info");
          }
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é Safari
          const safariVersion = navigator.userAgent.match(/Version\/(\d+)/)?.[1];
          if (safariVersion && parseInt(safariVersion) >= 16) {
            addLog(`‚úÖ Safari –≤–µ—Ä—Å–∏—è ${safariVersion} –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è`, "success");
          } else {
            addLog("‚ö†Ô∏è –í–µ—Ä—Å–∏—è Safari –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", "warning");
          }
        } else {
          addLog("‚ÑπÔ∏è –ù–µ iOS Safari", "info");
        }
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
      function checkSupport() {
        addLog("üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É...");

        const hasNotification = "Notification" in window;
        const hasServiceWorker = "serviceWorker" in navigator;
        const hasPushManager = "PushManager" in window;
        const hasPushAPI = "PushEvent" in window;

        addLog(`üì± –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: ${hasNotification ? "‚úÖ" : "‚ùå"}`);
        addLog(`‚öôÔ∏è Service Worker: ${hasServiceWorker ? "‚úÖ" : "‚ùå"}`);
        addLog(`üöÄ Push Manager: ${hasPushManager ? "‚úÖ" : "‚ùå"}`);
        addLog(`üîî Push API: ${hasPushAPI ? "‚úÖ" : "‚ùå"}`);

        if (hasNotification && hasServiceWorker && hasPushManager) {
          addLog("‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è", "success");
          return true;
        } else {
          addLog("‚ùå –ù–µ –≤—Å–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è", "error");
          return false;
        }
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
      function checkPermission() {
        addLog("üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è...");
        
        const permission = Notification.permission;
        addLog(`üîî –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: ${permission}`);
        
        if (permission === "granted") {
          updateStatus("–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ ‚úÖ", "success");
        } else if (permission === "denied") {
          updateStatus("–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ ‚ùå", "error");
        } else {
          updateStatus("–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—Ä–æ—à–µ–Ω–æ ‚è≥", "warning");
        }
        
        return permission;
      }

      // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
      async function requestPermission() {
        addLog("üîî –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ...");
        
        try {
          const permission = await Notification.requestPermission();
          addLog(`üì± –†–µ–∑—É–ª—å—Ç–∞—Ç: ${permission}`);
          
          if (permission === "granted") {
            updateStatus("–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ ‚úÖ", "success");
            addLog("‚úÖ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å push-–ø–æ–¥–ø–∏—Å–∫—É", "success");
          } else {
            updateStatus("–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ ‚ùå", "error");
          }
          
          return permission;
        } catch (error) {
          addLog(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, "error");
          return null;
        }
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ Service Worker
      async function checkServiceWorker() {
        addLog("‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º Service Worker...");
        
        try {
          const registration = await navigator.serviceWorker.getRegistration();
          
          if (registration) {
            addLog(`‚úÖ SW –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${registration.scope}`, "success");
            addLog(`üì± –ê–∫—Ç–∏–≤–Ω—ã–π: ${registration.active ? "–î–∞" : "–ù–µ—Ç"}`);
            addLog(`üîÑ –û–∂–∏–¥–∞—é—â–∏–π: ${registration.waiting ? "–î–∞" : "–ù–µ—Ç"}`);
            
            if (registration.active) {
              addLog("‚úÖ Service Worker –∞–∫—Ç–∏–≤–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ", "success");
            } else {
              addLog("‚ö†Ô∏è Service Worker –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω", "warning");
            }
          } else {
            addLog("‚ùå Service Worker –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω", "error");
          }
          
          return registration;
        } catch (error) {
          addLog(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, "error");
          return null;
        }
      }

      // –¢–µ—Å—Ç Service Worker
      async function testServiceWorker() {
        addLog("üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º Service Worker...");
        
        try {
          const registration = await navigator.serviceWorker.ready;
          
          if (!registration.active) {
            addLog("‚ùå Service Worker –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω", "error");
            return;
          }
          
          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
          const messageChannel = new MessageChannel();
          
          messageChannel.port1.onmessage = (event) => {
            if (event.data.success) {
              addLog("‚úÖ Service Worker –æ—Ç–≤–µ—Ç–∏–ª —É—Å–ø–µ—à–Ω–æ", "success");
            } else {
              addLog(`‚ùå –û—à–∏–±–∫–∞ SW: ${event.data.error}`, "error");
            }
          };
          
          registration.active.postMessage({
            type: "PING",
            timestamp: Date.now()
          }, [messageChannel.port2]);
          
          addLog("üì§ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ SW");
          
        } catch (error) {
          addLog(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è SW: ${error.message}`, "error");
        }
      }

      // –¢–µ—Å—Ç –æ–±—ã—á–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      function testNotification() {
        addLog("üîî –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–±—ã—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ...");
        
        if (Notification.permission !== "granted") {
          addLog("‚ùå –ù–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", "error");
          return;
        }
        
        try {
          const notification = new Notification("–¢–µ—Å—Ç Safari", {
            body: "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è Safari",
            icon: "/icons/icon192.png",
            badge: "/icons/icon192.png",
            tag: "safari-test",
            data: { url: "/", timestamp: Date.now() },
            requireInteraction: false,
            silent: false
          });
          
          addLog("‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–æ", "success");
          
          notification.onclick = () => {
            addLog("üëÜ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–∫–Ω—É—Ç–æ");
            window.focus();
          };
          
          notification.onclose = () => {
            addLog("‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ");
          };
          
        } catch (error) {
          addLog(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, "error");
        }
      }

      // –¢–µ—Å—Ç Push —á–µ—Ä–µ–∑ Service Worker
      async function testPush() {
        addLog("üöÄ –¢–µ—Å—Ç–∏—Ä—É–µ–º Push —á–µ—Ä–µ–∑ Service Worker...");
        
        try {
          const registration = await navigator.serviceWorker.ready;
          
          if (!registration.active) {
            addLog("‚ùå Service Worker –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω", "error");
            return;
          }
          
          const messageChannel = new MessageChannel();
          
          messageChannel.port1.onmessage = (event) => {
            if (event.data.success) {
              addLog("‚úÖ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ", "success");
            } else {
              addLog(`‚ùå –û—à–∏–±–∫–∞ Push: ${event.data.error}`, "error");
            }
          };
          
          registration.active.postMessage({
            type: "TEST_PUSH",
            data: {
              title: "Safari Push –¢–µ—Å—Ç",
              body: "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è Safari",
              icon: "/icons/icon192.png",
              badge: "/icons/icon192.png",
              tag: "safari-push-test",
              timestamp: Date.now()
            }
          }, [messageChannel.port2]);
          
          addLog("üì§ Push-—Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ SW");
          
        } catch (error) {
          addLog(`‚ùå –û—à–∏–±–∫–∞ Push: ${error.message}`, "error");
        }
      }

      // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è Safari
      async function testSafariSpecific() {
        addLog("üçé Safari-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π —Ç–µ—Å—Ç...");
        
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isSafari = /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent);
        
        if (!isIOS || !isSafari) {
          addLog("‚ÑπÔ∏è –¢–µ—Å—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è iOS Safari", "info");
          return;
        }
        
        addLog("‚úÖ –í—ã–ø–æ–ª–Ω—è–µ–º Safari-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã");
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º PWA –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
        if (window.navigator.standalone) {
          addLog("‚úÖ PWA —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω", "success");
        } else {
          addLog("‚ö†Ô∏è PWA —Ä–µ–∂–∏–º –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω", "warning");
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö API
        const hasIntersectionObserver = "IntersectionObserver" in window;
        const hasResizeObserver = "ResizeObserver" in window;
        const hasPerformanceObserver = "PerformanceObserver" in window;
        
        addLog(`üëÅÔ∏è IntersectionObserver: ${hasIntersectionObserver ? "‚úÖ" : "‚ùå"}`);
        addLog(`üìè ResizeObserver: ${hasResizeObserver ? "‚úÖ" : "‚ùå"}`);
        addLog(`üìä PerformanceObserver: ${hasPerformanceObserver ? "‚úÖ" : "‚ùå"}`);
        
        // –¢–µ—Å—Ç–∏—Ä—É–µ–º push-–ø–æ–¥–ø–∏—Å–∫—É
        try {
          const registration = await navigator.serviceWorker.ready;
          const subscription = await registration.pushManager.getSubscription();
          
          if (subscription) {
            addLog("‚úÖ Push-–ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞–π–¥–µ–Ω–∞", "success");
            addLog(`üîó Endpoint: ${subscription.endpoint.substring(0, 60)}...`);
            
            const keys = subscription.toJSON().keys;
            if (keys) {
              addLog(`üîë P256DH: ${keys.p256dh ? "‚úÖ" : "‚ùå"}`);
              addLog(`üîë Auth: ${keys.auth ? "‚úÖ" : "‚ùå"}`);
            }
          } else {
            addLog("‚ùå Push-–ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞", "warning");
            addLog("üí° –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ", "info");
          }
        } catch (error) {
          addLog(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏: ${error.message}`, "error");
        }
      }

      // –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
      async function fullCheck() {
        addLog("üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ª–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É...");
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É
        if (!checkSupport()) return;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º iOS
        checkIOS();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
        checkPermission();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º Service Worker
        await checkServiceWorker();
        
        // Safari-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
        await testSafariSpecific();
        
        addLog("‚úÖ –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      document.getElementById("checkSupport").addEventListener("click", checkSupport);
      document.getElementById("checkIOS").addEventListener("click", checkIOS);
      document.getElementById("requestPermission").addEventListener("click", requestPermission);
      document.getElementById("checkPermission").addEventListener("click", checkPermission);
      document.getElementById("checkSW").addEventListener("click", checkServiceWorker);
      document.getElementById("testSW").addEventListener("click", testServiceWorker);
      document.getElementById("testNotification").addEventListener("click", testNotification);
      document.getElementById("testPush").addEventListener("click", testPush);
      document.getElementById("testSafariSpecific").addEventListener("click", testSafariSpecific);
      document.getElementById("fullCheck").addEventListener("click", fullCheck);
      document.getElementById("clearLog").addEventListener("click", () => {
        log.innerHTML = "";
        addLog("üßπ –õ–æ–≥ –æ—á–∏—â–µ–Ω");
      });

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      window.addEventListener("load", () => {
        addLog("üåê –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É...");
        fullCheck();
      });

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç Service Worker
      navigator.serviceWorker.addEventListener("message", (event) => {
        addLog(`üì® –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç SW: ${JSON.stringify(event.data)}`);
      });

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Service Worker
      navigator.serviceWorker.addEventListener("error", (event) => {
        addLog(`‚ùå –û—à–∏–±–∫–∞ SW: ${event.error?.message || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`, "error");
      });
    </script>
  </body>
</html>
