# üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ CI/CD

## üéØ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å

–¢–µ–ø–µ—Ä—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ push –≤ main –≤–µ—Ç–∫—É!

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ–¥–∏–Ω —Ä–∞–∑:

### 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å GitHub Secrets

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π:
```bash
./ci-cd/scripts/setup-github-secrets-automated.sh
```

### 2. –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ GitHub: **Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New repository secret**

–î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —Å–µ–∫—Ä–µ—Ç—ã:

| –ù–∞–∑–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å |
|----------|----------|--------------|
| `POSTGRES_PASSWORD` | –ü–∞—Ä–æ–ª—å PostgreSQL | `openssl rand -base64 32` |
| `NEXTAUTH_SECRET` | –°–µ–∫—Ä–µ—Ç NextAuth | `openssl rand -base64 32` |
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ | @BotFather |
| `VAPID_PUBLIC_KEY` | VAPID –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á | `npx web-push generate-vapid-keys` |
| `VAPID_PRIVATE_KEY` | VAPID –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á | `npx web-push generate-vapid-keys` |
| `YC_ACCESS_KEY_ID` | Yandex Cloud Access Key | Yandex Cloud Console |
| `YC_SECRET_ACCESS_KEY` | Yandex Cloud Secret Key | Yandex Cloud Console |

### 3. –ì–æ—Ç–æ–≤–æ! 

–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–π—Ç–µ push –≤ main –≤–µ—Ç–∫—É:
```bash
git add .
git commit -m "Deploy to production"
git push origin main
```

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **Push –≤ main** ‚Üí –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è GitHub Actions
2. **–°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤** ‚Üí Docker images —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∏ –ø—É—à–∞—Ç—Å—è –≤ registry
3. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É** ‚Üí SSH –Ω–∞ production —Å–µ—Ä–≤–µ—Ä
4. **–°–æ–∑–¥–∞–Ω–∏–µ .env** ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ GitHub Secrets
5. **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ** ‚Üí Docker Compose –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
6. **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Let's Encrypt
7. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î** ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Prisma –º–∏–≥—Ä–∞—Ü–∏–π

## ‚úÖ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞** –∏–∑ GitHub Secrets
- ‚úÖ **–°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤** —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ **–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞–∑–æ–≤** –≤ GitHub Container Registry
- ‚úÖ **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä** —á–µ—Ä–µ–∑ SSH
- ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**
- ‚úÖ **–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤** –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- ‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤**
- ‚úÖ **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î**
- ‚úÖ **–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

- üîí **–°–µ–∫—Ä–µ—Ç—ã –≤ GitHub Secrets** (–Ω–µ –≤ –∫–æ–¥–µ)
- üîí **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ .env** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** (600 –¥–ª—è .env)
- üîí **–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**
- üîí **–ò–∑–æ–ª—è—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤** (–Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤)

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- **GitHub Actions**: https://github.com/asmtv1/gafus/actions
- **–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤**: `docker-compose ps`
- **–õ–æ–≥–∏**: `docker-compose logs -f`

## üåê –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º:

- **–û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç**: https://gafus.ru
- **–ü–∞–Ω–µ–ª—å —Ç—Ä–µ–Ω–µ—Ä–∞**: https://trainer-panel.gafus.ru
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫**: https://monitor.gafus.ru
- **–û—á–µ—Ä–µ–¥–∏**: https://queues.gafus.ru

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

### –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏:
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
docker-compose -f ci-cd/docker/docker-compose.prod.yml down
git reset --hard HEAD~1
docker-compose -f ci-cd/docker/docker-compose.prod.yml up -d
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
docker-compose -f ci-cd/docker/docker-compose.prod.yml logs -f [service_name]
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞:
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
docker-compose -f ci-cd/docker/docker-compose.prod.yml restart [service_name]
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:

### –ï—Å–ª–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —É–ø–∞–ª–æ:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ GitHub Actions logs
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É

### –ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f [service]`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª: `cat ci-cd/docker/.env`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `docker-compose config`

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ**! –ü—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–π—Ç–µ push –≤ main –≤–µ—Ç–∫—É, –∏ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
